# Вспомогательные скрипты для Backend

Эта папка содержит лёгкие обёртки над HTTP-эндпоинтами backend-сервиса, для которых пока нет UI.  
Скрипты используют только стандартную библиотеку Python (`urllib`), поэтому никаких дополнительных пакетов не требуется.

Все скрипты ожидают, что backend работает на `http://localhost:8000`  
(можно переопределить через переменную `API_BASE_URL`).  
Для действий, требующих авторизации, происходит вход по указанному MAX ID через `/api/v1/auth/login-by-max-id`.

## Быстрый старт

1. Убедитесь, что backend-сервисы запущены (см. `TESTING.md`).  
   Swagger UI доступен по адресу `http://localhost:8000/docs` — используйте его, чтобы смотреть схемы запросов/ответов и UUID (группы, факультеты, события и т.д.).

2. Один раз экспортируйте переменные окружения (пример для PowerShell):

   ```powershell
   $env:API_BASE_URL="http://localhost:8000/api/v1"
   $env:ADMIN_MAX_ID="900001"        # MAX ID сотрудника/админа (можно зарегистрировать через Swagger)
   $env:STUDENT_MAX_ID="1001"        # MAX ID студента для тестов платежей


Подставьте значения, соответствующие реальным аккаунтам в вашей базе.
Пользователя всегда можно зарегистрировать через Swagger (`POST /api/v1/auth/register`) и указать нужный `max_id`.

3. Запускайте скрипты системным Python 3:

   ```powershell
   python scripts/backend-tools/send_broadcast.py --title "Тест" --message "Добрый день!"
   ```

Каждый скрипт печатает JSON-ответ или читаемую ошибку.
Параметр `--max-id <value>` позволяет переопределить используемый MAX ID (иначе берётся из переменных окружения).

---

## Доступные скрипты

### `send_broadcast.py`

* Вызывает `POST /api/v1/broadcasts`.
* Требует MAX ID администратора/сотрудника (`ADMIN_MAX_ID`).
* Опциональные параметры `--group-id` или `--faculty-id` позволяют выбрать конкретную аудиторию.

Пример:

```powershell
python scripts/backend-tools/send_broadcast.py `
  --title "Актуальные новости" `
  --message "Сегодня в 18:00 состоится собрание" `
  --max-id 900001
```

---

### `create_payment.py`

* Вызывает `POST /api/v1/payments` от имени указанного пользователя.
* Работает с оплатами обучения/общежития/мероприятий (см. Swagger — схема `PaymentCreate`).
* Принимает сумму в рублях (конвертация в копейки происходит автоматически).
* Используйте `--event-id`, когда `--type=event`.

Пример:

```powershell
python scripts/backend-tools/create_payment.py `
  --max-id 1001 `
  --type tuition `
  --amount 1500 `
  --period "Семестр 1" `
  --description "Добровольный взнос"
```

---

### `add_student.py`

* Вызывает `POST /api/v1/users/students/add`.
* Требует данные студента (ФИО, город, студенческий билет).
* Если UUID не указаны, скрипт автоматически получает первый университет/факультет/группу через `/universities` и покажет, что было выбрано.
* Параметр `--print-only` выводит payload, не отправляя запрос.

Пример:

```powershell
python scripts/backend-tools/add_student.py `
  --full-name "Иван Петров" `
  --city "Москва" `
  --student-card "STU900" `
  --print-only
```

Уберите `--print-only`, чтобы действительно создать студента.

---

## Полезные советы

* Swagger (`http://localhost:8000/docs`) — главный источник информации по всем эндпоинтам, структурам ответов, enum-значениям и правилам валидации.
* При ошибке скрипт выводит HTTP-статус и текст ошибки backend — передавайте это backend-команде, если что-то нужно расследовать.
* Можно смело расширять эти скрипты или добавлять новые — используйте `common.py`, чтобы сохранить единый стиль работы.

